(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{360:function(e,t,n){e.exports={root:"root_19W-PG5a",loading:"loading__1nZTH3e"}},433:function(e,t,n){"use strict";var a=n(360),r=n.n(a);n.d(t,"default",(function(){return r.a}))},463:function(e,t,n){"use strict";n.r(t);var a=n(64),r=(n(119),n(11),n(89),n(73)),i=n(35),o=n(82),s=(n(55),n(429),n(13),n(15),n(86),n(432),n(56),n(57),n(37),n(353),n(355),n(58),n(203),n(190),n(346),n(87),n(377),/([a-zA-Z-]+)\*/);var u="request-current-level",l=function(){function e(t,n,a){Object(i.a)(this,e),this.index=t,this.map=n,this.loading=!1,this.Valves=new Map,this.getALLNextControllers=a}return Object(o.a)(e,[{key:"registValve",value:function(e){e.name,this.Valves.set(e.name,e),e._emit=this.emitchange.bind(this),e._controller=this}},{key:"unregistValve",value:function(e){e.name,e._emit=null,e._controller=null,this.Valves.delete(e.name)}},{key:"emitchange",value:function(e){this._pipeemit(e,this.getALLNextControllers())}},{key:"request",value:function(e){var t=this;if(this.loading)return Promise.reject("Valve ".concat(this.name," is loading!"));this.loading=!0;var n=[];return e===this?this.Valves.forEach((function(e){e.loading&&n.push(e.r())})):this.Valves.forEach((function(e){n.push(e.r())})),0===n.length?(this.loading=!1,Promise.resolve()):Promise.all(n).finally((function(){t.loading=!1}))}}]),e}(),c=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};Object(i.a)(this,e),this.name=t,this.loading=!0,this.wrap(n,a)}return Object(o.a)(e,[{key:"wrap",value:function(e,t){var n=this;this.r=Object(a.a)(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,n.loading=!0,n.name,a.next=5,e();case 5:n.loading=!1,n.name,a.next=14;break;case 9:a.prev=9,a.t0=a.catch(0),console.log(a.t0),t(a.t0),n.loading=!1;case 14:case"end":return a.stop()}}),a,null,[[0,9]])})))}},{key:"emit",value:function(e){this.name,this._emit(e)}}]),e}();var v=function(){function e(t){var n=this;Object(i.a)(this,e),Object.assign(this,function(e){var t=e.split(/>/),n=[],a=[];function i(e){for(var t=e.name,n=0;n<a.length;n++){var r=a[n](t);if(r)return r}return null}return t.forEach((function(e,t){var i=/\[?([a-zA-Z,\s\-()*]+)\]?/.exec(e.trim())[1].split(",").map((function(e){return e.trim()})),o=new l(t,i,(function(){return n.slice(t+1)})),u=[],c=[];n.push({staticValve:o,dynamicValve:u}),a.push((function(e){for(var a=0;a<i.length;a++){var v=i[a],d=s.exec(v);if(d){var h=function(){var a=d[1];if(e.startsWith(a)&&!c.includes(e)){var r=new l(t,[e],(function(){var a=c.findIndex((function(t){return t===e}));return u.slice(a).concat(n.slice(t+1))}));r._pipeemit=o._pipeemit,u.push(r),c.push(e)}var i=c.findIndex((function(t){return t===e}));return{v:{controller:u[i],remove:function(){u.splice(i,1),c.splice(i,1)}}}}();if("object"===Object(r.a)(h))return h.v}else if(v===e)return{controller:o}}return null}))})),{controllers:n,registValve:function(e){var t=i(e);t&&t.controller.registValve(e)},unregistValve:function(e){var t=i(e);t&&(console.log(t),t.controller.unregistValve(e),t.remove&&t.remove())}}}(t)),this.controllers.forEach((function(e){e.staticValve._pipeemit=n.eventHandler.bind(n)})),this.currReq=[],this.loading=!1}var t;return Object(o.a)(e,[{key:"request",value:function(e){e||(e=this.controllers.slice()),this.loading||(this.loading=!0,this.currindex=e[0],this.currReq=e,this._req())}},{key:"eventHandler",value:function(e,t){e===u&&this.request(t)}},{key:"_req",value:(t=Object(a.a)(regeneratorRuntime.mark((function e(){var t,n,a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.currReq.length){e.next=17;break}return(t=this.currReq.shift())instanceof l||(a=(n=t).staticValve,(r=n.dynamicValve).length&&(this.currReq=r.concat(this.currReq)),t=a),e.prev=3,e.next=6,t.request(this.currindex);case 6:return e.next=8,this._req();case 8:e.next=15;break;case 10:e.prev=10,e.t0=e.catch(3),console.log(e.t0),this.currReq=[],this.loading=!1;case 15:e.next=18;break;case 17:this.loading=!1;case 18:case"end":return e.stop()}}),e,this,[[3,10]])}))),function(){return t.apply(this,arguments)})}]),e}(),d={extends:{data:function(){return{pipe__:null}},created:function(){this.pipe__=new v(this.graph)},mounted:function(){var e=this;this.$watch((function(){return e.pipe__.loading}),(function(t){e.$emit("pipestatechange",t)}))},provide:function(){return{registToPipe:this._registToPipe,unRegistToPipe:this._unRegistToPipe}},methods:{pipeRequest:function(){this.pipe__.request()},_registToPipe:function(e){this.pipe__.registValve(e)},_unRegistToPipe:function(e){this.pipe__.unregistValve(e)}}},props:{component:{type:[String,Object],default:"div"},graph:String},mounted:function(){this.pipeRequest()}},h=n(8),f=Object(h.a)(d,(function(){var e=this.$createElement;return(this._self._c||e)(this.component,this._g(this._b({tag:"component"},"component",this.$attrs,!1),this.$listeners),[this._t("default")],2)}),[],!1,null,null,null).exports,p=(n(189),{extends:{inject:["registToPipe","unRegistToPipe"],data:function(){return{model:null,loading:!0,valve__:null}},watch:{model:function(){this.valve__.emit(u)}},created:function(){this.valve__=new c(this.name,this.request,this.onErrorFunc),this.registToPipe(this.valve__)},mounted:function(){var e=this;this.$watch((function(){return e.valve__._controller.loading}),(function(t){e.$emit("pipestatechange",t)}))},destroyed:function(){this.unRegistToPipe(this.valve__)},methods:{onErrorFunc:function(e){throw e}}},props:{component:{type:[String,Object],default:"div"},request:Function,valve:[String,Number,Object,Array],name:String},data:function(){return{model:this.valve}},mounted:function(){var e=this;this.$on("pipestatechange",this.onLoadingChange),this.unwatchValve=this.$watch((function(){return e.valve}),(function(t){e.model=t}))},beforeDestroy:function(){this.unwatchValve(),this.$off("pipestatechange",this.onLoadingChange)},methods:{onLoadingChange:function(e){this.loading=e}}}),m=n(433);var g=Object(h.a)(p,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(e.component,e._g(e._b({tag:"component",class:e.$style.root},"component",e.$attrs,!1),e.$listeners),[e.loading?n("u-loading",{class:e.$style.loading}):e._t("default")],2)}),[],!1,(function(e){this.$style=m.default.locals||m.default}),null,null).exports,_=(n(347),n(198),n(374),n(88),n(434),n(38),n(191),n(354),n(437),n(116),n(438),n(16));n(439),n(440);function b(e,t){var n=e.list,a=e.path,r=e.current,i=n.find((function(e){return Object(_.get)(e,a,null)===r}));n.length&&!i?t(n[0]):t(i)}function x(e){return new Promise((function(t,n){setTimeout((function(){t(e)}),800)}))}var k={components:{kubePipe:f,kubeValve:g},data:function(){return{loading:!1,graph:"a > [b, c] > d",model:{a:"",b:"",c:"",d:""},data:{a:[],b:[],c:[],d:[]}}},methods:{loadA:function(){var e=this;return Object(a.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x([{text:"a",value:"a"},{text:"b",value:"b"},{text:"c",value:"c"}]);case 2:n=t.sent,e.data.a=n,b({list:n,path:"value",current:e.model.a},(function(t){e.model.a=t.value}));case 5:case"end":return t.stop()}}),t)})))()},loadB:function(){var e=this;return Object(a.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x([{text:"d",value:"d"},{text:"e",value:"e"},{text:"f",value:"f"}]);case 2:n=t.sent,e.data.b=n,b({list:n,path:"value",current:e.model.b},(function(t){e.model.b=t.value}));case 5:case"end":return t.stop()}}),t)})))()},loadC:function(){var e=this;return Object(a.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x([{text:"g",value:"g"},{text:"h",value:"h"},{text:"i",value:"i"}]);case 2:n=t.sent,e.data.c=n,b({list:n,path:"value",current:e.model.c},(function(t){e.model.c=t.value}));case 5:case"end":return t.stop()}}),t)})))()},loadD:function(){var e=this;return Object(a.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x([{text:"j",value:"j"},{text:"k",value:"k"},{text:"l",value:"l"}]);case 2:n=t.sent,e.data.d=n,b({list:n,path:"value",current:e.model.d},(function(t){e.model.d=t.value}));case 5:case"end":return t.stop()}}),t)})))()}}},w=Object(h.a)(k,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._v("\n      全局加载中 "),e.loading?n("u-loading"):e._e(),e._v(" "),n("br"),e._v(" "),n("kube-pipe",{ref:"pipe",attrs:{component:"u-linear-layout",graph:e.graph,direction:"vertical"},on:{pipestatechange:function(t){e.loading=t}}},[n("kube-valve",{attrs:{name:"a",valve:e.model.a,request:e.loadA}},[e._v("\n          A: "),n("u-select",{attrs:{data:e.data.a},model:{value:e.model.a,callback:function(t){e.$set(e.model,"a",t)},expression:"model.a"}})],1),e._v(" "),n("kube-valve",{attrs:{name:"b",valve:e.model.b,request:e.loadB}},[e._v("\n          B: "),n("u-select",{attrs:{data:e.data.b},model:{value:e.model.b,callback:function(t){e.$set(e.model,"b",t)},expression:"model.b"}})],1),e._v(" "),n("kube-valve",{attrs:{name:"c",valve:e.model.c,request:e.loadC}},[e._v("\n          C: "),n("u-select",{attrs:{data:e.data.c},model:{value:e.model.c,callback:function(t){e.$set(e.model,"c",t)},expression:"model.c"}})],1),e._v(" "),n("kube-valve",{attrs:{name:"d",valve:e.model.d,request:e.loadD}},[e._v("\n          D: "),n("u-select",{attrs:{data:e.data.d},model:{value:e.model.d,callback:function(t){e.$set(e.model,"d",t)},expression:"model.d"}})],1)],1),e._v(" "),n("demo-visualize-data",{model:{value:e.model,callback:function(t){e.model=t},expression:"model"}})],1)}),[],!1,null,null,null);t.default=w.exports}}]);